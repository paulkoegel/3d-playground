$ ->

  # EMBER it up
  # -----------
  Irmingard.columnsController.loadCards()

  # Drag & Drop
  # -----------

  $('.draggable').live 'mouseover', ->
    if $(@).children('.snapper').hasClass('active')
      $(@).children('.snapper').removeClass 'active'# if $(@).children(".snapper").hasClass("active")
    $(@).draggable
      containment: "#container"
      snap: ".active"
      snapMode: "inner"
      snapTolerance: 8
      zIndex: 300
      revert: "invalid"
      revertDuration: 350
      scroll: false
      start: (event, ui) ->
        console.log 'dragging started'
        dragStart this

      drag: (event, ui) ->
        console.log 'dragging in process'
        dragActive this

      stop: (event, ui) ->
        console.log 'dragging stopped'
        dragStop this

  $('.draggable').live 'mousedown', ->
    console.log 'mouse down'
    $('img', @).css 'border', '1px solid #0000ff'

  $('.draggable').live 'mouseup', ->
    $('img', @).css 'border', '1px solid #cccccc'

  $('.draggable').live 'mouseout', ->
    dragged_card = domToCard(@)
    $(@).children('.snapper').addClass 'active' if dragged_card.get('open')

  # FAYE
  # ----

  faye = new Faye.Client 'http://localhost:9292/irmingard-faye'
  faye.subscribe '/game<%= '1' %>', (data) ->
    console.log 'incoming FAYE data: ' + data
    alert(data)

  $('form.trigger').submit ->
    pushToFaye $(@)
    #$.post $(@).attr('action') + '.js', 'jaja', null, 'script'
    false

  $('a.trigger').click ->
    pushToFaye $(@)
    false
